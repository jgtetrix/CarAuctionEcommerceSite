<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BidNDrive</title>
    <script src="https://kit.fontawesome.com/dac92d3981.js" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="style.css">

</head>

<body>
    <section id="header">
        <a href="#"><img src="img/BidNDrive.png" class="logo" alt="BidNDrive Logo" height="150"></a>
        <div>
            <ul id="navbar">
                <li><a href="index.html">Auctions</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="contact.html">Contact</a></li>
                <li><a href="login.html">Login</a></li>
                <li><a href="account.html"><img src="img/accounticon.png" class="logo" alt="Account Logo" height="30"></a></li>
            </ul>
        </div>
    </section>

    <h3 id="car-title">2002 Honda CR-V EX AWD</h3>

    <section id="details-body">
        <div>     
            <img src="img/2002HondaCRVEXAWD/Cover.jpeg" id="main-image">
            <div id="test">
                <section id="countdown-bid-bar">
                    <div id="countdown"></div>
                    <div id="highest-bid"></div>
                </section>
            </div>
            <div id="place-bid-location">
                <div id="place-bid">
                    <button id="bid-button" onclick="openForm()">Place Bid</button>
                </div>
            </div>
            
            <div class="loginPopup">
                <div class="formPopup" id="popupForm">
                    <form action="placeBid.php" class="formContainer" method="post">
                    <input type="hidden" name="car_id" value="6">
                    <input type="hidden" name="user_id" value="">
                    <label for="bidAmount">Bid Amount:</label>
                    <input type="number" id="bid_amount" name="bid_amount" required><br>
                    <label for="name">Name:</label>
                    <input type="text" id="name" name="name" required><br>
                    <label for="address">Address:</label>
                    <input type="text" id="address" name="address" required><br>
                    <label for="email">Email:</label>
                    <input type="email" id="email" name="email" required><br>
                    <label for="phone">Phone Number:</label>
                    <input type="tel" id="phone" name="phone" required><br>
                    <label for="cc">Credit Card Information:</label>
                    <input type="text" id="cc" name="cc" required><br>
                    <input type="submit" value="Submit">
                    <button type="button" class="btn cancel" onclick="closeForm()">Close</button>
                    </form>
                </div>
            </div>
        </div>
        
        <div id="right-side-flex">
            <table class="styled-table">
                <thead>
                    <tr>
                        <th>Make</th>
                        <th>Model</th>
                        <th>Mileage</th>
                        <th>VIN</th>
                        <th>Title Status</th>
                        <th>Location</th>
                        <th>Seller</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Honda</td>
                        <td>CR-V</td>
                        <td>35,800</td>
                        <td>JHLRD78842C047146</td>
                        <td>Clean (CA)</td>
                        <td>Martinez, CA 94553</td>
                        <td>ThePhotographersGarage <a href="">Contact</a></td>
                    </tr>
                </tbody>
            </table>
            
            <table class="styled-table">
                <thead>
                    <tr>
                        <th>Engine</th>
                        <th>Drivetrain</th>
                        <th>Transmission</th>
                        <th>Body Style</th>
                        <th>Exterior Color</th>
                        <th>Interior Color</th>
                        <th>Seller Type</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>2.4L I4</td>
                        <td>4WD/AWD</td>
                        <td>Automatic (4-Speed)</td>
                        <td>SUV/Crossover</td>
                        <td>Nighthawk Black</td>
                        <td>Black</td>
                        <td>Private</a></td>
                    </tr>
                </tbody>
            </table>

            <h4 id="additional">Additional Images:</h4>            
            <div class="additional-photos">
                <img src="img/2002HondaCRVEXAWD/Cover.jpeg" alt="Car Photo 1-1">
                <img src="img/2002HondaCRVEXAWD/Front.jpeg" alt="Car Photo 1-2">
                <img src="img/2002HondaCRVEXAWD/frontseats.jpeg" alt="Car Photo 1-3">
                <img src="img/2002HondaCRVEXAWD/interior.jpeg" alt="Car Photo 1-4">
                <!-- Add more additional photos as needed -->
            </div>
            <div class="additional-photos">
                <img src="img/2002HondaCRVEXAWD/rear.jpeg" alt="Car Photo 1-6">
                <img src="img/2002HondaCRVEXAWD/rearseats.jpeg" alt="Car Photo 1-7">
                <img src="img/2002HondaCRVEXAWD/rearseats2.jpeg" alt="Car Photo 1-8">
                <img src="img/2002HondaCRVEXAWD/side.jpeg" alt="Car Photo 1-9">
                <!-- Add more additional photos as needed -->
            </div>

            <div id="modal" class="modal">
                <span class="close">&times;</span>
                <img class="modal-content" id="modal-image">
                <div id="caption"></div>
            </div>

        </div>
    </section>

    <section id="newsletter" class="section-p1 section-m1">
        <div class="newstext">
            <h4>Sign Up For Our Newsletter</h4>
            <p>Get E-mail updates about our latest drops and <span>special offers.</span></p>
        </div>
        <div class="form">
            <input type="text" placeholder="Your email address">
            <button class="normal">Sign Up</button>
        </div>
    </section>

    <footer class="section-p1">
        <div class="details">
            <img src="img/BidNDrive.png" height="300">
            <h4>Contact:</h4>
            <p><Strong>Address:</Strong> 1000 Morris Ave, Union, New Jersey, 07083</p>
            <p><Strong>Phone:</Strong> +1 888 888 8888</p>
            <p><Strong>Hours:</Strong> 08:00 - 16:00 EST Monday - Friday</p>
        </div>
        <div id="copyright">
            <p>BidNDrive.com Â© 2022 BidNDrive </p>
        </div>
    </footer>

</body>

<!-- BEGINNING OF SCRIPTS -->

<script>
    function isset() {
        if (document.cookie.indexOf("login_cookie") >= 0) {
            return true;
        }
        return false;

    }
</script>
<script>
    function openForm() {
         if (isset() == true){
            document.getElementById("popupForm").style.display = "block";
         }
         else{
            alert("Please Login before you place a bid!");  
         }
      
    }
    function closeForm() {
      document.getElementById("popupForm").style.display = "none";
    }
</script>

<script>
    function countdown(endDate) {
        const now = new Date().getTime(); //Finds the difference between the 'Current time' and 'End time' of the listing
        const distance = endDate - now;

        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);

        return {
        days,
        hours,
        minutes,
        seconds,
        distance
        };
    }
</script>

<script>
    function updateCountdown(endDate) {
        const parent = document.getElementById('countdown-bid-bar'); //Finds the specific section on the html page

        const timer = parent.querySelector('#countdown');

        const time = countdown(endDate);    //Finds time difference

        timer.innerHTML = `Time Remaining: ${time.days}d ${time.hours}h ${time.minutes}m ${time.seconds}s`; //Prints

        if (time.distance < 0) {    //When countdown is 0 changes the text to SOLD
            clearInterval(interval);
            timer.innerHTML = 'SOLD';
            $.ajax({
                    url: "send_winner_email.php",
                    type: "POST",
                    data: { car_id: "6" },
                    success: (response) => {
                        // Check if the response indicates success or failure
                        if (response.success) {
                            console.log('success')
                        } else {
                        // If the response indicates failure, log the error to the console
                        console.error(response.error);
                        }
                    },
                    error: (xhr, status, error) => {
                        // If the AJAX request fails, log the error to the console
                        console.error(error);
                    }
                });
        }
    }   
        const endDate = new Date('April 29, 2023 23:59:59').getTime();  //Gets end Date (Need to Query DB)

        updateCountdown(endDate);

        const interval = setInterval(() => { //Constantly undates every second
        updateCountdown(endDate);
        }, 1000);
</script>


<script>
    // Get all elements with class "additional-photos"
    var additionalPhotos = document.querySelectorAll('.additional-photos');

    // Loop through each "additional-photos" element
    additionalPhotos.forEach(function(additionalPhoto) {
    // Add click event listener to each "additional-photos" element
    additionalPhoto.addEventListener('click', function(event) {
        // Get the clicked image source and alt text
        var imageSrc = event.target.src;
        var imageAlt = event.target.alt;

        // Create a new modal image element
        var modalImage = new Image();
        modalImage.src = imageSrc;
        modalImage.alt = imageAlt;

        // Show the modal with the clicked image
        document.getElementById('modal').style.display = 'block';
        document.getElementById('modal-image').src = imageSrc;
        document.getElementById('modal-image').alt = imageAlt;
        document.getElementById('caption').innerHTML = imageAlt;

        // Close the modal when the "x" button is clicked
        document.getElementsByClassName('close')[0].addEventListener('click', function() {
        document.getElementById('modal').style.display = 'none';
        });

        // Close the modal when clicked outside the modal image
        window.addEventListener('click', function(event) {
        if (event.target == document.getElementById('modal')) {
            document.getElementById('modal').style.display = 'none';
        }
        });
    });
});
</script>

<script>
    function getCookie(cname) {
        let name = cname + "=";
        let decodedCookie = decodeURIComponent(document.cookie);
        let ca = decodedCookie.split(';');
        for(let i = 0; i <ca.length; i++) {
            let c = ca[i];
            while (c.charAt(0) == ' ') {
            c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
            }
        }
        return "";
    }

    var myCookieValue = getCookie('login_cookie');
    document.getElementsByName('user_id').value = myCookieValue;

</script>

<script>
    $.ajax({        
          url: "get_highest_bid_time.php",       
          type: "POST",       
          data: { car_id: "6" },       
          success: function(response) {       
                 document.getElementById("highest-bid").textContent = "Highest Bid: $" + response;
          }       

     });        
</script>


<!-- END OF SCRIPTS -->

</html>